;/*FB_PKG_DELIM*/

__d("MessengerMQTTPresence",["FBMqttChannel","ODS"],(function(a,b,c,d,e,f,g){"use strict";var h="/orca_presence",i="mqtt_web.presence",j="/send_additional_contacts",k=!1;function a(a){if(k)return;k=!0;c("FBMqttChannel").subscribe(h,function(b){b=JSON.parse(b);b&&b.list&&(b.list_type&&b.list_type==="full"&&a.reset(),a.setMultiFromMQTT(b.list),d("ODS").bumpEntityKey(3303,i,"buddylist.event"),d("ODS").bumpEntityKey(3303,i,"buddylist.active_buddies",b.list.length))})}function b(){k=!1,c("FBMqttChannel").unsubscribeAll(h)}var l=new Map(),m=1e3*60*3;function e(a){if(l.has(a)){var b=l.get(a);if(b!=null&&b>Date.now())return;l["delete"](a)}l.set(a,Date.now()+m);c("FBMqttChannel").publish(j,JSON.stringify({additional_contacts:[a]}))}g.subscribe=a;g.unsubscribe=b;g.sendAdditionalBuddyRequest=e}),98);
__d("MessengerMQTTPresence.bs",["MessengerMQTTPresence"],(function(a,b,c,d,e,f,g){"use strict";function a(a){d("MessengerMQTTPresence").sendAdditionalBuddyRequest(a)}g.sendAdditionalBuddyRequest=a}),98);
__d("ArmadilloDataTraceType.bs",[],(function(a,b,c,d,e,f){"use strict";a=[0,13];f.armadilloMessageSend=a}),66);
__d("LsDataTraceFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("1743851");b=d("FalcoLoggerInternal").create("ls_data_trace",a);e=b;g["default"]=e}),98);
__d("LSDataTraceFlush.bs",["ArmadilloDataTraceType.bs","LSDataTraceType","LSInt64.bs","LSIntEnum","LsDataTraceFalcoEvent","ODS","Promise","ReQL.bs","bs_belt_Option","bs_caml","bs_caml_int64","bs_caml_option","bs_int64","clearTimeout","promiseDone","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";function h(a,b,d){var e=a.length;if(e===0)return[c("bs_caml_int64").neg_one,c("bs_caml_int64").neg_one,void 0,void 0,void 0];e=a.find(function(a){return a.errorMessage!==void 0});e=c("bs_belt_Option").mapWithDefault(e===void 0?void 0:c("bs_caml_option").some(e),void 0,function(a){return a.errorMessage});a=a[a.length-1|0];var f=c("bs_caml_int64").of_float(Date.now()),g=[0,12e4],h=a.timestampMs;g=c("bs_int64").compare(c("bs_caml_int64").sub(f,d),g)>=0;return!b&&g?[c("bs_caml_int64").sub(f,d),a.checkPointId,h,e,"trace expired"]:[c("bs_caml_int64").sub(h,d),a.checkPointId,h,e,e]}function i(a){return a.reduce(function(a,b,d){var e=c("bs_int64").to_string(b.checkPointId),f=b.timestampMs,g=c("bs_int64").to_string(c("bs_belt_Option").getWithDefault(b.syncChannel,c("bs_caml_int64").neg_one));b=b.tags;b=b!==void 0?","+b:"";if(d===0)a.pointsList="".concat("(",e,",",g,b,")");else{d=String(c("bs_caml_int64").to_int32(c("bs_caml_int64").sub(f,a.lastCheckPointTimestamp)));a.pointsList=a.pointsList.concat("-",d,"-(",e,",",g,b,")")}a.lastCheckPointTimestamp=f;return a},{lastCheckPointTimestamp:c("bs_caml_int64").zero,pointsList:""}).pointsList}var j=[0,2];function k(a,b){var e=b.traceId,f=b.shouldFlush,g=b.traceType,k=c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").TASK))?"send":c("bs_caml").i64_eq(g,d("ArmadilloDataTraceType.bs").armadilloMessageSend)?"armadillo send":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_INIT))?"encrypted_backups_init":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_ADD_DEVICE))?"encrypted_backups_add_device":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_UPLOAD))?"encrypted_backups_upload":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_RESTORE))?"encrypted_backups_restore":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_BACKUP))?"encrypted_backups_media_backup":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SYNC_EPOCHS))?"encrypted_backups_sync_epochs":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").SAP_VESTA_LOGIN))?"sap_vesta_login":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").SAP_VESTA_REGISTRATION))?"sap_vesta_registration":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_OPT_OUT_OF_BACKUP))?"encrypted_backups_opt_out_of_backup":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_FETCH_BACKUPS_METADATA))?"encrypted_backups_fetch_backups_metadata":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_CREATE_EXTRA_VIRTUAL_DEVICE))?"encrypted_backups_create_extra_virtual_device":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_FETCH_BACKUP_STATUS))?"encrypted_backups_fetch_backup_status":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_THIRD_PARTY_ID_GENERATION))?"encrypted_backups_third_party_id_generation":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_MEDIA_RESTORE))?"encrypted_backups_media_restore":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_DELETE_BACKUP))?"encrypted_backups_delete_backup":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_INIT))?"shadow_encrypted_backups_init":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_ADD_DEVICE))?"shadow_encrypted_backups_add_device":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_UPLOAD))?"shadow_encrypted_backups_upload":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_RESTORE))?"shadow_encrypted_backups_restore":c("bs_caml").i64_eq(g,d("LSIntEnum").ofNumber(c("LSDataTraceType").ENCRYPTED_BACKUPS_SHADOW_DELETE_BACKUP))?"shadow_encrypted_backups_delete_backup":b.contextTwo;g=b.traceType;var l=c("bs_caml").i64_eq(g,d("ArmadilloDataTraceType.bs").armadilloMessageSend)?"tam_message_send":b.contextOne,m=c("bs_caml").i64_eq(b.traceType,j)?void 0:b.predefinedId,n=b.initTimestampMs;return d("ReQL.bs").toArray(d("ReQL.bs").getKeyRange(d("ReQL.bs").fromIndexAscending(a.table("data_trace_addon").index("traceIdAddonId")),{hd:e,tl:0})).then(function(a){var b=h(a,f,n),g=b[0],j=b[1],o=b[3],p=b[4],q=a.length,r=i(a);c("LsDataTraceFalcoEvent").log(function(){return{check_point_count:c("bs_caml_option").some(d("LSInt64.bs").string(c("bs_caml_int64").of_int32(q))),check_point_list:r,client_event_ts:c("bs_caml_option").some(d("LSInt64.bs").string(c("bs_caml_int64").of_float(Date.now()))),cold_start_time:void 0,data_trace_id:e,database_id:l,delivered_messages:void 0,error_message:p,first_error_message:o,has_backgrounded:!1,last_check_point:c("bs_caml_option").some(d("LSInt64.bs").string(j)),latency:c("bs_caml_option").some(d("LSInt64.bs").string(g)),media_type:void 0,num_of_attachments:void 0,persisted_metadata:void 0,predefined_id:m,sent_rich_media_messages:void 0,sent_text_messages:void 0,start_time:c("bs_caml_option").some(d("LSInt64.bs").string(n)),trace_flow:c("bs_belt_Option").getWithDefault(k,"")}})}).then(function(){return a.table("data_trace_meta")["delete"]({hd:e,tl:0})})}function a(a,c){return d("ReQL.bs").first(d("ReQL.bs").getKeyRange(d("ReQL.bs").fromTableAscending(a.table("data_trace_meta")),{hd:c,tl:0})).then(function(c){if(c!==void 0)return k(a,c);else return b("Promise").resolve()})}var l={contents:void 0};function m(a){var e=[0,12e4];return a.runInTransaction(function(a){return d("ReQL.bs").toArray(d("ReQL.bs").bounds(d("ReQL.bs").getKeyRange(d("ReQL.bs").fromIndexAscending(a.table("data_trace_meta").index("shouldFlushInitTimestampMsTraceId")),{hd:!1,tl:0}),{NAME:"lessThan",VAL:{hd:c("bs_caml_int64").sub(c("bs_caml_int64").of_float(Date.now()),e),tl:0}})).then(function(c){return b("Promise").all(c.map(function(b){return k(a,b)}))})},"readwrite")}function n(){var a=l.contents;if(a!==void 0){c("clearTimeout")(c("bs_caml_option").valFromOption(a));return}}function o(a){c("promiseDone")(m(a),function(){n();var b=c("setTimeout")(function(){o(a)},6e4);l.contents=c("bs_caml_option").some(b)},function(){n(),d("ODS").bumpEntityKey(3185,"mw_trace","error")});return n}e=[0,4];f=[0,5];var p=j;e=e;f=f;var q=k;a=a;var r=n,s=o;g.dataTraceSync=p;g.dataTraceRichMediaSend=e;g.dataTraceRichMediaDownload=f;g.flushForTraceMeta=q;g.flush=a;g.stopFlushExpiredDataTraces=r;g.flushExpiredDataTraces=s}),98);
__d("MWPReplyLogging.bs",["I64","QPLUserFlow","bs_caml_obj","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h=new Map();function i(a){var b=Date.now()|0;h.set(d("I64").to_string(a),b);return b}function j(a){var b=h.get(d("I64").to_string(a));if(b==null)return i(a);else return b}function a(a,b,e){if(e){a?c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:j(b)}):c("QPLUserFlow").endSuccess(c("qpl")._(25298086,"3996"),{instanceKey:j(b)});h["delete"](d("I64").to_string(b));return}}function b(a,b,d){if(a!==void 0){if(c("bs_caml_obj").caml_equal(a,b)){c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"same_message",{instanceKey:j(d)});return}if(c("bs_caml_obj").caml_notequal(a,b)){a=j(d);c("QPLUserFlow").addPoint(c("qpl")._(25298086,"3996"),"switch_message",{instanceKey:a});c("QPLUserFlow").endCancel(c("qpl")._(25298086,"3996"),{instanceKey:a});c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:i(d),timeoutInMs:6e4});return}}c("QPLUserFlow").start(c("qpl")._(25298086,"3996"),{cancelOnUnload:!0,instanceKey:i(d),timeoutInMs:6e4})}g.logClearReply=a;g.logSetReply=b}),98);
__d("MessageRequestsInfoBannerShownFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("258");b=d("FalcoLoggerInternal").create("message_requests_info_banner_shown",a);e=b;g["default"]=e}),98);
__d("MessageRequestsThreadActionConfirmedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("259");b=d("FalcoLoggerInternal").create("message_requests_thread_action_confirmed",a);e=b;g["default"]=e}),98);
__d("MessageRequestsThreadActionTappedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("260");b=d("FalcoLoggerInternal").create("message_requests_thread_action_tapped",a);e=b;g["default"]=e}),98);
__d("MessageRequestsThreadDenialOptionsTappedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("261");b=d("FalcoLoggerInternal").create("message_requests_thread_denial_options_tapped",a);e=b;g["default"]=e}),98);
__d("MessageRequestsBulkActionConfirmedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("256");b=d("FalcoLoggerInternal").create("message_requests_bulk_action_confirmed",a);e=b;g["default"]=e}),98);
__d("MessageRequestsBulkActionEditFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("2614");b=d("FalcoLoggerInternal").create("message_requests_bulk_action_edit",a);e=b;g["default"]=e}),98);
__d("MessageRequestsBulkActionTappedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("257");b=d("FalcoLoggerInternal").create("message_requests_bulk_action_tapped",a);e=b;g["default"]=e}),98);
__d("MessageRequestsViewThreadlistFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f,g){"use strict";a=c("getFalcoLogPolicy_DO_NOT_USE")("263");b=d("FalcoLoggerInternal").create("message_requests_view_threadlist",a);e=b;g["default"]=e}),98);